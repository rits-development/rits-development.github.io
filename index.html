<html>
<head>
    <script type="application/javascript">
      var webSocket = null;

      let connect = () => {
        let endpoint = document.getElementById('endpoint').value;
        webSocket = new WebSocket(endpoint);
        let onmessageListener = (event) => {
          if (event.data === 'pong') {
            document.getElementById('status').classList.toggle('ping');
            setTimeout((ws) => {
              if (!!ws && ws.readyState === WebSocket.OPEN) {
                document.getElementById('status').classList.toggle('ping');
                ws.send('ping');
              }
            }, 500, webSocket);
          } else {
            console.log('onmessage. content: ' + event.data);
            var paragraph = document.createElement('p');
            paragraph.appendChild(document.createTextNode(event.data));
            document.getElementById('messages').appendChild(paragraph);
          }
        };

        let onopenListener = (evt) => {
          console.log('onopen.');
          document.getElementById('status').classList.remove('disconnected');
          const closeButton = document.getElementById('closeConnection');
          closeButton.removeAttribute('disabled');
          closeButton.addEventListener('click', () => {
            webSocket.close();
          });
          webSocket.send('ping');
        };

        let oncloseListener = () => {
          console.log('onclose.');
          document.getElementById('status').classList.add('disconnected');
          const closeButton = document.getElementById('closeConnection');
          closeButton.setAttribute('disabled', 'disabled');
          closeButton.removeEventListener('click', () => {
          });
          webSocket.removeEventListener('close', oncloseListener);
          webSocket.removeEventListener('message', onmessageListener);
          webSocket.removeEventListener('open', onopenListener);
          webSocket = null;
          connect();
        };

        webSocket.onmessage = onmessageListener;
        webSocket.onopen = onopenListener;
        webSocket.onclose = oncloseListener;
      };
    </script>

    <style type="text/css">
        #status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: green;
            margin: 5px;
            transition-duration: 200ms;
            transition-property: background-color;
        }

        #status.ping {
            background-color: white !important;
        }

        #status.disconnected {
            background-color: red !important;
        }
    </style>

</head>
<body>

<form>
    connection to: <input type="text" id="endpoint" name="endpoint" value="ws://127.0.0.1:12345"
                          style="width: 200px"><br>
    <div id="status" class="disconnected"></div>
</form>

<input type="button" onclick="connect()" value="connect to WebSocket endpoint"/><br><br>

<input id="closeConnection" type="button" value="Close connection" disabled/>

<div id="messages">

</div>

</body>
</html>
